---
phase: 01-monorepo-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified: [packages/api/package.json, packages/api/src/index.ts, packages/api/src/routes/health.ts, packages/api/src/db/supabase.ts, .env.example]
autonomous: true
user_setup:
  - service: supabase
    why: "Database and future auth requires Supabase project setup"
    env_vars:
      - name: SUPABASE_URL
        source: "Supabase Dashboard â†’ Settings â†’ API â†’ Project URL"
      - name: SUPABASE_ANON_KEY
        source: "Supabase Dashboard â†’ Settings â†’ API â†’ anon public key"
      - name: SUPABASE_SERVICE_ROLE_KEY
        source: "Supabase Dashboard â†’ Settings â†’ API â†’ service_role key (keep secret!)"
    dashboard_config:
      - task: "Create Supabase project"
        location: "https://supabase.com/dashboard/new"
        details: "Choose a project name (e.g., 'alvarocortes-portfolio'), select a region close to you, set a database password"
    local_dev:
      - "Copy .env.example to .env.local and fill in values from Supabase dashboard"
      - "Never commit .env.local to git"

must_haves:
  truths:
    - "Hono server starts on port 3000"
    - "GET /health returns JSON response"
    - "Supabase client initializes without error"
    - "RPC types are exported for frontend consumption"
  artifacts:
    - path: "packages/api/src/index.ts"
      provides: "Hono app with RPC type export"
      exports: ["app", "AppType"]
      contains: "typeof app"
    - path: "packages/api/src/routes/health.ts"
      provides: "Health check endpoint"
      contains: "health"
    - path: "packages/api/src/db/supabase.ts"
      provides: "Supabase client factory"
      exports: ["createSupabaseClient"]
  key_links:
    - from: "packages/api/src/index.ts"
      to: "packages/api/src/routes/health.ts"
      via: "route import"
      pattern: "import.*health"
    - from: "packages/api/src/db/supabase.ts"
      to: "@supabase/supabase-js"
      via: "Supabase client"
      pattern: "createClient"
---

<objective>
Configure the backend stack: Hono API with Supabase integration and RPC type exports.

Purpose: Enable backend development with type-safe API routes and database access.
Output: Working Hono server with health endpoint, Supabase client, and exported types for frontend RPC.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/phases/01-monorepo-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install backend dependencies</name>
  <files>packages/api/package.json</files>
  <action>
Update packages/api/package.json with full backend dependencies:
```json
{
  "name": "@alvarocortes/api",
  "private": true,
  "type": "module",
  "main": "src/index.ts",
  "types": "src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "import": "./src/index.ts"
    }
  },
  "scripts": {
    "dev": "bun run --hot src/index.ts",
    "build": "bun build src/index.ts --outdir dist --target bun",
    "start": "bun run dist/index.js",
    "lint": "echo 'Configured in Plan 01-04'",
    "type-check": "tsc --noEmit"
  },
  "dependencies": {
    "hono": "^4.11.4",
    "@hono/zod-validator": "^0.5.0",
    "@supabase/supabase-js": "^2.90.1",
    "zod": "^3.24.0",
    "@alvarocortes/shared": "workspace:*"
  },
  "devDependencies": {
    "@types/bun": "latest",
    "typescript": "^5.7.2"
  }
}
```

Run `bun install` in packages/api to install dependencies.
  </action>
  <verify>cd packages/api && bun install && bun pm ls</verify>
  <done>All backend dependencies installed</done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client configuration</name>
  <files>packages/api/src/db/supabase.ts, .env.example</files>
  <action>
Create packages/api/src/db/supabase.ts:
```typescript
import { createClient, SupabaseClient } from "@supabase/supabase-js"

// Type for database schema (will be generated from Supabase later)
export type Database = Record<string, unknown>

/**
 * Create Supabase client for public operations (uses anon key)
 * Use this for unauthenticated/public data fetching
 */
export function createSupabaseClient(): SupabaseClient<Database> {
  const url = process.env.SUPABASE_URL
  const anonKey = process.env.SUPABASE_ANON_KEY

  if (!url || !anonKey) {
    throw new Error(
      "Missing Supabase environment variables. See .env.example for required variables."
    )
  }

  return createClient<Database>(url, anonKey)
}

/**
 * Create Supabase admin client for privileged operations (uses service role key)
 * Use this ONLY for admin operations that bypass RLS
 * NEVER expose this client to the frontend
 */
export function createSupabaseAdmin(): SupabaseClient<Database> {
  const url = process.env.SUPABASE_URL
  const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY

  if (!url || !serviceRoleKey) {
    throw new Error(
      "Missing Supabase admin environment variables. See .env.example for required variables."
    )
  }

  return createClient<Database>(url, serviceRoleKey)
}
```

Update root .env.example to include all required variables:
```bash
# Supabase Configuration
# Get these from: Supabase Dashboard â†’ Settings â†’ API
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# API Configuration
API_PORT=3000

# Frontend Environment Variables (VITE_ prefix for client access)
VITE_API_URL=http://localhost:3000
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```
  </action>
  <verify>cat packages/api/src/db/supabase.ts && cat .env.example</verify>
  <done>Supabase client factory created with proper typing</done>
</task>

<task type="auto">
  <name>Task 3: Create Hono app with health endpoint and RPC export</name>
  <files>packages/api/src/index.ts, packages/api/src/routes/health.ts</files>
  <action>
Create packages/api/src/routes/health.ts:
```typescript
import { Hono } from "hono"

const health = new Hono()
  .get("/", (c) => {
    return c.json({
      status: "ok",
      timestamp: new Date().toISOString(),
      service: "alvarocortes-api",
    })
  })

export { health }
```

Create packages/api/src/index.ts:
```typescript
import { Hono } from "hono"
import { cors } from "hono/cors"
import { logger } from "hono/logger"
import { health } from "./routes/health"

const app = new Hono()
  // Middleware
  .use("*", logger())
  .use(
    "*",
    cors({
      origin: ["http://localhost:5173", "http://localhost:4173"],
      credentials: true,
    })
  )
  // Routes
  .route("/health", health)
  // Root endpoint
  .get("/", (c) => {
    return c.json({
      message: "Alvaro Cortes API",
      version: "0.0.1",
      docs: "/health",
    })
  })

// Export type for Hono RPC client
export type AppType = typeof app

// Export app for potential serverless deployment
export { app }

// Start server when run directly
const port = Number(process.env.API_PORT) || 3000
console.log(`ðŸš€ API server starting on http://localhost:${port}`)

export default {
  port,
  fetch: app.fetch,
}
```
  </action>
  <verify>cat packages/api/src/index.ts && cat packages/api/src/routes/health.ts</verify>
  <done>Hono app created with health endpoint and AppType export for RPC</done>
</task>

<task type="auto">
  <name>Task 4: Verify API server starts</name>
  <files></files>
  <action>
Run the API server to verify:
1. `cd packages/api && bun dev` starts Hono server
2. Check terminal output shows server listening on port 3000
3. Test health endpoint with curl

Note: Supabase client will throw if env vars not set, but health endpoint should work without them.
Create a temporary .env.local with dummy values for testing if needed.
  </action>
  <verify>cd packages/api && timeout 5 bun dev &amp; sleep 2 &amp;&amp; curl http://localhost:3000/health || true</verify>
  <done>Hono server starts, health endpoint responds with JSON</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `bun dev` in packages/api starts Hono server on port 3000
- [ ] GET /health returns JSON with status: "ok"
- [ ] AppType is exported for RPC type safety
- [ ] Supabase client factory compiles without errors
- [ ] TypeScript compiles without errors
</verification>

<success_criteria>
- All tasks completed
- Backend stack fully functional
- Hono server running with middleware (logger, CORS)
- Supabase client configured for database access
- RPC types exported for frontend type safety
- Ready for future API route development
</success_criteria>

<output>
After completion, create `.planning/phases/01-monorepo-foundation/01-03-SUMMARY.md`

Also generate `.planning/phases/01-monorepo-foundation/01-03-USER-SETUP.md` from the user_setup frontmatter.
</output>
