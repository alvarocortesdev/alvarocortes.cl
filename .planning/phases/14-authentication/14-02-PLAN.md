---
phase: 14-authentication
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - apps/admin/src/pages/Login.tsx
  - apps/admin/src/pages/AuthCallback.tsx
  - apps/admin/src/pages/Dashboard.tsx
  - apps/admin/src/App.tsx
  - apps/admin/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "Login page displays GitHub sign-in button"
    - "OAuth callback handles redirect and shows success"
    - "Dashboard only accessible when authenticated"
    - "Unauthenticated users see login page"
  artifacts:
    - path: "apps/admin/src/pages/Login.tsx"
      provides: "GitHub OAuth login UI"
      contains: "signInWithGitHub"
    - path: "apps/admin/src/pages/AuthCallback.tsx"
      provides: "OAuth redirect handler"
      contains: "auth/callback"
    - path: "apps/admin/src/pages/Dashboard.tsx"
      provides: "Authenticated admin home"
      contains: "signOut"
    - path: "apps/admin/src/App.tsx"
      provides: "Route configuration"
      contains: "ProtectedRoute"
  key_links:
    - from: "Login.tsx"
      to: "AuthContext"
      via: "useAuth().signInWithGitHub"
    - from: "App.tsx"
      to: "ProtectedRoute"
      via: "wraps Dashboard route"
    - from: "main.tsx"
      to: "AuthProvider"
      via: "wraps entire app"

user_setup:
  - service: github
    why: "OAuth app required for GitHub login"
    dashboard_config:
      - task: "Create GitHub OAuth App"
        location: "GitHub → Settings → Developer Settings → OAuth Apps → New OAuth App"
        details: |
          Application name: Alvaro Cortes Admin
          Homepage URL: https://admin.alvarocortes.cl
          Authorization callback URL: https://bqdnkrbdowjopxjopzqq.supabase.co/auth/v1/callback
  - service: supabase
    why: "Enable GitHub provider in Supabase Auth"
    dashboard_config:
      - task: "Enable GitHub OAuth provider"
        location: "Supabase Dashboard → Authentication → Providers → GitHub"
        details: "Toggle enabled, paste Client ID and Client Secret from GitHub OAuth App"
---

<objective>
Create login flow with GitHub OAuth, callback handler, and protected dashboard.

Purpose: Enable admin authentication via GitHub, with proper redirect handling.
Output: Working login page, OAuth callback, protected dashboard route.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-admin-foundation/13-RESEARCH.md
@.planning/phases/14-authentication/14-01-SUMMARY.md

Supabase project reference: bqdnkrbdowjopxjopzqq
Supabase callback URL: https://bqdnkrbdowjopxjopzqq.supabase.co/auth/v1/callback
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Configure GitHub OAuth App and Supabase Provider</action>
  <instructions>
Before the login flow will work, you need to configure GitHub OAuth:

**Step 1: Create GitHub OAuth App**
1. Go to https://github.com/settings/developers
2. Click "New OAuth App"
3. Fill in:
   - Application name: `Alvaro Cortes Admin`
   - Homepage URL: `https://admin.alvarocortes.cl`
   - Authorization callback URL: `https://bqdnkrbdowjopxjopzqq.supabase.co/auth/v1/callback`
4. Click "Register application"
5. Copy the **Client ID**
6. Click "Generate a new client secret" and copy the **Client Secret**

**Step 2: Enable GitHub in Supabase**
1. Go to https://supabase.com/dashboard/project/bqdnkrbdowjopxjopzqq/auth/providers
2. Find "GitHub" in the list
3. Toggle it ON
4. Paste the Client ID and Client Secret from GitHub
5. Save

**Step 3: Set Environment Variables in Vercel**
1. Go to Vercel dashboard → admin project → Settings → Environment Variables
2. Add:
   - `VITE_SUPABASE_URL` = `https://bqdnkrbdowjopxjopzqq.supabase.co`
   - `VITE_SUPABASE_ANON_KEY` = (get from Supabase Dashboard → Project Settings → API → anon public key)
  </instructions>
  <verification>Supabase Dashboard shows GitHub provider enabled with green checkmark</verification>
  <resume-signal>Type "configured" when GitHub OAuth is set up in both GitHub and Supabase</resume-signal>
</task>

<task type="auto">
  <name>Task 1: Create Login page</name>
  <files>apps/admin/src/pages/Login.tsx</files>
  <action>
Create Login page with GitHub OAuth button:

```typescript
import { useAuth } from '@/contexts/AuthContext'
import { Navigate } from 'react-router-dom'

export function Login() {
  const { user, loading, signInWithGitHub } = useAuth()

  // Redirect if already logged in
  if (!loading && user) {
    return <Navigate to="/" replace />
  }

  return (
    <div className="min-h-screen bg-neutral-900 flex flex-col items-center justify-center">
      <div className="text-center">
        <h1 className="text-4xl font-bold text-white mb-2">Admin Panel</h1>
        <p className="text-neutral-400 mb-8">Alvaro Cortes Portfolio</p>

        <button
          onClick={signInWithGitHub}
          disabled={loading}
          className="flex items-center gap-3 bg-neutral-800 hover:bg-neutral-700 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50"
        >
          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
          {loading ? 'Loading...' : 'Sign in with GitHub'}
        </button>
      </div>
    </div>
  )
}
```

Style matches existing admin app dark theme.
  </action>
  <verify>File exists with signInWithGitHub button</verify>
  <done>Login page displays GitHub OAuth button</done>
</task>

<task type="auto">
  <name>Task 2: Create OAuth callback handler</name>
  <files>apps/admin/src/pages/AuthCallback.tsx</files>
  <action>
Create callback page that handles OAuth redirect:

```typescript
import { useEffect, useState } from 'react'
import { useNavigate } from 'react-router-dom'
import { supabase } from '@/lib/supabase'

export function AuthCallback() {
  const navigate = useNavigate()
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    // Handle the OAuth callback
    const handleCallback = async () => {
      const { error } = await supabase.auth.exchangeCodeForSession(
        window.location.href
      )

      if (error) {
        setError(error.message)
        return
      }

      // Redirect to dashboard on success
      navigate('/', { replace: true })
    }

    handleCallback()
  }, [navigate])

  if (error) {
    return (
      <div className="min-h-screen bg-neutral-900 flex flex-col items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-red-500 mb-4">Authentication Error</h1>
          <p className="text-neutral-400 mb-4">{error}</p>
          <a href="/login" className="text-blue-400 hover:underline">
            Try again
          </a>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-neutral-900 flex items-center justify-center">
      <div className="text-white">Completing sign in...</div>
    </div>
  )
}
```

This handles the OAuth redirect from GitHub/Supabase and exchanges the code for a session.
  </action>
  <verify>File exists with exchangeCodeForSession call</verify>
  <done>Callback handler processes OAuth redirect</done>
</task>

<task type="auto">
  <name>Task 3: Create Dashboard page with logout</name>
  <files>apps/admin/src/pages/Dashboard.tsx</files>
  <action>
Create initial Dashboard page with user info and logout:

```typescript
import { useAuth } from '@/contexts/AuthContext'

export function Dashboard() {
  const { user, signOut } = useAuth()

  return (
    <div className="min-h-screen bg-neutral-900">
      <header className="border-b border-neutral-800 px-6 py-4">
        <div className="flex items-center justify-between">
          <h1 className="text-xl font-bold text-white">Admin Panel</h1>
          <div className="flex items-center gap-4">
            <span className="text-neutral-400 text-sm">
              {user?.email || user?.user_metadata?.user_name}
            </span>
            <button
              onClick={signOut}
              className="text-sm text-neutral-400 hover:text-white transition-colors"
            >
              Sign out
            </button>
          </div>
        </div>
      </header>

      <main className="p-6">
        <h2 className="text-2xl font-bold text-white mb-4">Welcome</h2>
        <p className="text-neutral-400">
          You are logged in as {user?.user_metadata?.full_name || user?.email}.
        </p>
        <p className="text-neutral-500 text-sm mt-2">
          User ID: {user?.id}
        </p>
        <p className="text-neutral-500 text-sm mt-4">
          Phase 15 will add blog management here.
        </p>
      </main>
    </div>
  )
}
```

Shows user info and ID (needed for next plan to update RLS policies).
  </action>
  <verify>File exists with signOut button and user.id display</verify>
  <done>Dashboard shows user info and logout functionality</done>
</task>

<task type="auto">
  <name>Task 4: Update App.tsx with routes</name>
  <files>apps/admin/src/App.tsx</files>
  <action>
Replace current placeholder with routes:

```typescript
import { Routes, Route } from 'react-router-dom'
import { Login } from '@/pages/Login'
import { AuthCallback } from '@/pages/AuthCallback'
import { Dashboard } from '@/pages/Dashboard'
import { ProtectedRoute } from '@/components/ProtectedRoute'

export function App() {
  return (
    <Routes>
      <Route path="/login" element={<Login />} />
      <Route path="/auth/callback" element={<AuthCallback />} />
      <Route
        path="/"
        element={
          <ProtectedRoute>
            <Dashboard />
          </ProtectedRoute>
        }
      />
    </Routes>
  )
}
```

Routes:
- /login - Public login page
- /auth/callback - OAuth redirect handler
- / - Protected dashboard (redirects to /login if not authenticated)
  </action>
  <verify>File has Routes, ProtectedRoute wrapper around Dashboard</verify>
  <done>App routes configured with protected dashboard</done>
</task>

<task type="auto">
  <name>Task 5: Wrap app with AuthProvider</name>
  <files>apps/admin/src/main.tsx</files>
  <action>
Add AuthProvider to main.tsx:

```typescript
import { StrictMode } from "react"
import { createRoot } from "react-dom/client"
import { BrowserRouter } from "react-router-dom"
import { AuthProvider } from "@/contexts/AuthContext"
import { App } from "./App"
import "./styles/main.css"

const root = document.getElementById("root")
if (!root) throw new Error("Root element not found")

createRoot(root).render(
  <StrictMode>
    <BrowserRouter>
      <AuthProvider>
        <App />
      </AuthProvider>
    </BrowserRouter>
  </StrictMode>
)
```

AuthProvider must wrap the entire app to provide auth context to all routes.
  </action>
  <verify>main.tsx has AuthProvider wrapping App</verify>
  <done>AuthProvider enables auth context throughout app</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] GitHub OAuth configured (checkpoint passed)
- [ ] Login page renders with GitHub button
- [ ] OAuth callback handles redirect
- [ ] Dashboard protected by ProtectedRoute
- [ ] Unauthenticated users redirected to /login
- [ ] `bun run type-check` passes
- [ ] `bun run build --filter=@alvarocortes/admin` succeeds
</verification>

<success_criteria>

- All tasks completed
- GitHub OAuth flow works end-to-end
- Session persists across refresh
- Logout clears session
  </success_criteria>

<output>
After completion, create `.planning/phases/14-authentication/14-02-SUMMARY.md`
</output>
