---
phase: 13-admin-foundation
plan: 03
type: execute
wave: 2
depends_on: ["13-01"]
files_modified:
  - apps/admin/vercel.json
autonomous: false

must_haves:
  truths:
    - "Admin app accessible at admin.alvarocortes.cl"
    - "HTTPS working on subdomain"
    - "SPA routing works (no 404 on refresh)"
  artifacts:
    - path: "apps/admin/vercel.json"
      provides: "Vercel deployment config for admin"
      contains: "buildCommand"
  key_links:
    - from: "GitHub push"
      to: "Vercel admin project"
      via: "Auto-deploy on push"
    - from: "admin.alvarocortes.cl"
      to: "Vercel admin project"
      via: "CNAME DNS record"

user_setup:
  - service: vercel
    why: "Deploy admin to subdomain"
    dashboard_config:
      - task: "Create new Vercel project for admin"
        location: "Vercel Dashboard → Add New Project"
        details: "Import same Git repo, set Root Directory to 'apps/admin'"
      - task: "Add custom domain"
        location: "Project Settings → Domains"
        details: "Add admin.alvarocortes.cl"
  - service: dns
    why: "Point subdomain to Vercel"
    dashboard_config:
      - task: "Create CNAME record"
        location: "DNS provider (where alvarocortes.cl is managed)"
        details: "CNAME: admin → cname.vercel-dns.com"
---

<objective>
Deploy admin app to admin.alvarocortes.cl as a separate Vercel project.

Purpose: Enable admin access at dedicated subdomain, isolated from main site.
Output: Live admin app at https://admin.alvarocortes.cl
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-admin-foundation/13-RESEARCH.md
@.planning/phases/13-admin-foundation/13-01-SUMMARY.md

Existing Vercel config:
@vercel.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create admin vercel.json</name>
  <files>apps/admin/vercel.json</files>
  <action>
Create apps/admin/vercel.json:
```json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "framework": "vite",
  "buildCommand": "cd ../.. && bun run build --filter=@alvarocortes/admin",
  "outputDirectory": "dist",
  "installCommand": "cd ../.. && bun install",
  "rewrites": [
    { "source": "/((?!assets/).*)", "destination": "/index.html" }
  ]
}
```

The rewrites rule enables SPA routing (same pattern as main site).
The cd ../.. is needed because Vercel runs from apps/admin/ but needs root package.json.
  </action>
  <verify>File exists with valid JSON</verify>
  <done>vercel.json ready for admin deployment</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create Vercel project and configure DNS</action>
  <instructions>
I've created the vercel.json config. Now you need to:

**Step 1: Create Vercel Project**
1. Go to https://vercel.com/new
2. Import the same Git repo (alvarocortesdev/alvarocortes.cl)
3. IMPORTANT: Set "Root Directory" to `apps/admin`
4. Framework Preset: Vite
5. Deploy

**Step 2: Add Custom Domain**
1. In the new project, go to Settings → Domains
2. Add domain: `admin.alvarocortes.cl`
3. Vercel will show DNS instructions

**Step 3: Configure DNS**
1. Go to your DNS provider (where alvarocortes.cl is managed)
2. Add CNAME record:
   - Name: `admin`
   - Value: `cname.vercel-dns.com`
3. Wait for propagation (usually 1-5 minutes)

**Step 4: Environment Variables (optional now, required for Phase 14)**
In Vercel project settings → Environment Variables, add:
- VITE_SUPABASE_URL
- VITE_SUPABASE_ANON_KEY

You can use Vercel's Shared Environment Variables if you want both projects to share the same values.
  </instructions>
  <verification>curl -I https://admin.alvarocortes.cl returns 200</verification>
  <resume-signal>Type "deployed" when admin.alvarocortes.cl is accessible, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Verify deployment and commit</name>
  <files>apps/admin/vercel.json</files>
  <action>
After user confirms deployment:

1. Verify the deployment works:
```bash
curl -I https://admin.alvarocortes.cl
```

2. Git add and commit the vercel.json:
```bash
git add apps/admin/vercel.json
git commit -m "feat(13-03): add admin vercel.json for subdomain deployment"
```

3. Push to trigger rebuild (should already be deployed but ensures config is tracked):
```bash
git push origin main
```
  </action>
  <verify>Git commit created, push succeeds</verify>
  <done>Admin deployment config committed and pushed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] apps/admin/vercel.json exists with correct config
- [ ] https://admin.alvarocortes.cl loads admin app
- [ ] Refresh on /any-route doesn't 404 (SPA routing works)
- [ ] HTTPS certificate valid (green lock)
</verification>

<success_criteria>

- All tasks completed
- Admin accessible at production URL
- Vercel auto-deploys on push
- SPA routing functional
  </success_criteria>

<output>
After completion, create `.planning/phases/13-admin-foundation/13-03-SUMMARY.md`
</output>
