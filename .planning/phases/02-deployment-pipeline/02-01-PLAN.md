---
phase: 02-deployment-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [vercel.json, .vercel/]
autonomous: false

user_setup:
  - service: vercel
    why: "Deployment hosting"
    env_vars: []
    account_setup:
      - url: "https://vercel.com/signup"
        skip_if: "Already have Vercel account"
    dashboard_config: []
    local_dev:
      - "vercel login (if not authenticated)"

must_haves:
  truths:
    - "Pushing to main triggers Vercel build"
    - "Site is accessible at Vercel URL"
    - "Frontend can access Supabase environment variables"
    - "PR branches create preview deployments"
  artifacts:
    - path: "vercel.json"
      provides: "Vercel monorepo configuration"
    - path: ".vercel/project.json"
      provides: "Vercel project link"
  key_links:
    - from: "GitHub repo"
      to: "Vercel project"
      via: "Git integration"
      pattern: "automatic deploy on push"
    - from: "Vercel build"
      to: "apps/web"
      via: "root directory config"
    - from: "VITE_SUPABASE_URL"
      to: "frontend runtime"
      via: "Vite env injection"
---

<objective>
Deploy apps/web to Vercel with automatic CI/CD from GitHub.

Purpose: Ship early to enable iteration. Having the site live allows continuous validation of features as they're built.
Output: Live site at Vercel URL with automatic deploys on push to main.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-monorepo-foundation/01-02-SUMMARY.md
@apps/web/package.json
@apps/web/vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Vercel configuration for monorepo</name>
  <files>vercel.json</files>
  <action>
    Create vercel.json at repo root with monorepo settings:
    - Set `framework` to "vite"
    - Set `buildCommand` to "cd ../.. && bun install && bun run build"
    - Set `outputDirectory` to "dist"
    - Set `installCommand` to "bun install"

    The build runs from apps/web context, so buildCommand navigates to root first.

    Note: Vercel will be configured to use apps/web as the root directory, so paths are relative to that.
  </action>
  <verify>cat vercel.json shows valid JSON with framework, buildCommand, outputDirectory</verify>
  <done>vercel.json exists with correct monorepo configuration</done>
</task>

<task type="auto">
  <name>Task 2: Deploy to Vercel and configure environment variables</name>
  <files>.vercel/project.json</files>
  <action>
    1. Run `vercel link` to connect repo to Vercel project:
       - If prompted to set up new project, say yes
       - Project name: alvarocortes
       - Root directory: apps/web

    2. If auth error occurs, this becomes an auth gate - ask user to run `vercel login`

    3. Add environment variables for all environments (production, preview, development):
       ```
       vercel env add VITE_SUPABASE_URL production preview development
       vercel env add VITE_SUPABASE_ANON_KEY production preview development
       ```

       Read values from .env.local:
       - VITE_SUPABASE_URL = SUPABASE_URL value
       - VITE_SUPABASE_ANON_KEY = SUPABASE_ANON_KEY value

       Note: Only frontend-safe keys (VITE_ prefix). Never expose SUPABASE_SERVICE_ROLE_KEY to frontend.

    4. Deploy to production:
       ```
       vercel --prod
       ```

    5. Capture the deployment URL from output.

    6. Connect to GitHub for automatic deploys:
       ```
       vercel git connect
       ```
  </action>
  <verify>
    - vercel ls shows the deployment
    - curl [deployment-url] returns 200
    - vercel env ls shows VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY
  </verify>
  <done>
    - Project linked to Vercel
    - Environment variables configured
    - Production deployment live
    - GitHub connected for auto-deploys
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Deployed apps/web to Vercel with GitHub integration</what-built>
  <how-to-verify>
    1. Visit the Vercel deployment URL (will be provided after Task 2)
    2. Confirm: Page loads without errors
    3. Confirm: "Alvaro Cortes" heading is visible
    4. Open browser DevTools Console - no errors
    5. Check Vercel Dashboard (https://vercel.com/dashboard):
       - Project "alvarocortes" exists
       - Shows connected to GitHub repo
       - Environment variables are set (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY)
  </how-to-verify>
  <resume-signal>Type "approved" if site loads correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] vercel.json exists with correct configuration
- [ ] `vercel ls` shows successful deployment
- [ ] Site accessible at Vercel URL
- [ ] Environment variables visible in `vercel env ls`
- [ ] GitHub integration connected
</verification>

<success_criteria>

- All tasks completed
- Site deployed and accessible
- Environment variables configured for frontend
- GitHub auto-deploy connected
- User verified deployment works
</success_criteria>

<output>
After completion, create `.planning/phases/02-deployment-pipeline/02-01-SUMMARY.md`
</output>
